if (self.CavalryLogger) { CavalryLogger.start_js(["8aeA9"]); }

__d('TickerReadStateTracking',['DataAttributeUtils','Style','clickRefAction'],(function a(b,c,d,e,f,g){var h=73,i='ticker_hover',j=[];function k(m){if(!m)return null;var n=JSON.parse(c('DataAttributeUtils').getDataFt(m));if(!n)return null;if(n.mf_story_key)return n.mf_story_key;if(n.fbid)return n.fbid;return null;}function l(m){var n=k(m);if(!n||n in j)return;j[n]=true;var o={evt:h};c('clickRefAction')(i,m,null,'FORCE',{ft:o});}f.exports.log=l;}),null);
__d('getLegacyContextualDialogInstance',['DataStore','Parent'],(function a(b,c,d,e,f,g){function h(i){var j=c('DataStore').get(i,'LegacyContextualDialog');if(!j){var k=c('Parent').byClass(i,'uiOverlay');if(k)j=c('DataStore').get(k,'overlay');}return j;}f.exports=h;}),null);
__d('TickerStoryList',['csx','cx','Animation','Arbiter','AsyncRequest','AsyncSignal','BanzaiODS','Bootloader','ChannelConstants','CSS','DOM','DOMVector','Event','HTML','Keys','LayerFadeOnHide','LiveTimer','NavigationMessage','Parent','Rect','Run','ScrollableArea','SelectorDeprecated','Style','TickerController','TickerReadStateTracking','Toggler','UFIUIEvents','URI','UserActivity','UserAgent_DEPRECATED','Vector','clickRefAction','collectDataAttributes','containsNode','emptyFunction','ex','ge','getElementText','getLegacyContextualDialogInstance','goURI','tickerPhoteSnowLiftOpenStatus','setTimeout','throttle'],(function a(b,c,d,e,f,g,h,i){var j=15000;function k(l,m,n){this._root=l;this._content=c('DOM').find(l,'.ticker_stream');this._stories=c('DOM').find(this._root,'.tickerActivityStories');this._scrollableArea=m;this._container=c('DOM').find(l,'div.uiScrollableAreaWrap');this._newestStory={};this._objectIDs=[];this._fetchedStories={};this._fetchedStoriesDialog={};this._storyDialogResources={};this._removedStoryIDs=[];this._storiesToRemove=[];var o=Date.now();this._initTime=o;this._lastUpdate=o;this._lastPull=o;this._lastInsert=o;this._autoloadStoryIndex=1;this._scrollTopThreshold=100;this._scrollTopPrompt=c('DOM').find(this._root,'.scrollTopPrompt');this._scrollTopPromptVisible=false;this._maxStoriesToKeep=50;this._minStoriesToKeep=25;this._tickerInSidebarMode=!!c('Parent').byClass(this._root,'fbChatSidebar');this._loadStoriesWithActions();c('clickRefAction')('ticker_flyout');c('clickRefAction')('ticker_flyout_prefetch');c('clickRefAction')('ticker_flyout_loadtime');c('clickRefAction')('ticker_stream');this._uaCurStoryIDFetch=null;this._uaCurStoryIDPrefetch=null;var p=c('DOM').create('div',{className:'storyQueue hidden_elem'});this._storyQueue=p;c('DOM').appendContent(this._root,p);this._lastKStories={head:null,tail:null,count:0,actors:{},apps:{},stories:{}};this._dedupeKeys={};this._initObjectIDs();this._initConfig(n);this._resetMorePager();this._initListeners();this._initSubscriptions(n);c('Arbiter').inform('ticker/init',this,c('Arbiter').BEHAVIOR_PERSISTENT);this._poll();}Object.assign(k.prototype,{ADS_IDLE_MS:300000,FLYOUT_MAX_HEIGHT:450,FLYOUT_OFFSET_THRESHOLD:20,FLYOUT_COMMENT_OFFSET:15,FLYOUT_VIEWPORT_PADDING:75,FLYOUT_ACTION_FOOTER_PADDING:8,FLYOUT_TARGET_HEIGHT_OFFSET:25,DEFAULT_LOOK_BEHIND:10,_lastKStoriesInsert:function l(m){this._lastKStories.stories[m.getAttribute("data-story-key")]=true;var n={story:m,next:null};if(this._lastKStories.head)this._lastKStories.head.next=n;this._lastKStories.head=n;this._lastKStories.count++;if(!this._lastKStories.tail)this._lastKStories.tail=this._lastKStories.head;var o=m.getAttribute("data-actor");if(!this._lastKStories.actors[o])this._lastKStories.actors[o]=0;this._lastKStories.actors[o]++;var p=m.getAttribute("data-app");if(p){if(!this._lastKStories.apps[p])this._lastKStories.apps[p]=0;this._lastKStories.apps[p]++;}if(this._lastKStories.count>this.DEFAULT_LOOK_BEHIND){while(this._lastKStories.tail&&!this._lastKStoriesRemove(this._lastKStories.tail.story))this._lastKStories.tail=this._lastKStories.tail.next;if(!this._lastKStories.tail)this._lastKStories.head=null;}},_lastKStoriesRemove:function l(m){var n=m.getAttribute("data-story-key"),o=m.getAttribute("data-actor"),p=m.getAttribute("data-app");if(this._lastKStories.stories[n]){delete this._lastKStories.stories[n];this._lastKStories.actors[o]--;if(p)this._lastKStories.apps[p]--;this._lastKStories.count--;return true;}else return false;},_loadStoriesWithActions:function l(){var m=c('ge')('rightCol');if(!m)return;this._toggleWrapper=c('DOM').scry(m,'.tickerToggleWrapper')[0];if(this._toggleWrapper){var n=c('DOM').scry(this._stories,'.tickerStoryWithButton');this._storiesWithActions={};for(var o=0;o<n.length;o++){var p=n[o];this._storiesWithActions[p.getAttribute('data-story-key')]=p;}}},_initConfig:function l(m){Object.assign(this,{_newest:m.newest,_page_newest:m.newest,_timeout:m.timeout,_heartbeatTimeout:Math.min(5000,m.heartbeatTimeout),_maxHeartbeatTimeout:Math.max(30000,m.maxHeartbeatTimeout),_pullTimeout:Math.max(30000,m.pullTimeout),_insertTimeout:m.insertTimeout,_maxQueueLength:m.maxQueueLength,_heartbeatEndpoint:m.heartbeatEndpoint,_popupOnHover:m.popupOnHover,_userIdleTimeout:m.userIdleTimeout,_tickerSource:m.tickerSource,_logFlyouts:m.logFlyouts,_userScrollGaurdDelay:m.userScrollGaurdDelay,_rescheduleScrollToTopDelay:m.rescheduleScrollToTopDelay});},_initListeners:function l(){this._listeners=c('Event').listen(this._root,{click:this._handleClick.bind(this),keydown:this._handleKeydown.bind(this),mouseout:this._handleMouseout.bind(this),mouseover:this._handleMouseover.bind(this),mousedown:this._tickerDeClicker.bind(this),mouseup:this._handleMouseup.bind(this)});this._listeners.scroll=c('Event').listen(this._container,'scroll',this._handleScroll.bind(this));c('setTimeout')(this._initInfiniteScrollListener.bind(this),0);},_initSubscriptions:function l(m){c('Run').onLeave(this._cleanup.bind(this));this._subscriptions=[c('Arbiter').subscribe(c('NavigationMessage').NAVIGATION_BEGIN,this._onNavHandler.bind(this)),c('Arbiter').subscribe('composer/publish',this._handleComposerPublish.bind(this)),c('Arbiter').subscribe('Ticker/storiesInserted',this._handleStoriesInserted.bind(this)),c('Arbiter').subscribe('Ticker/fixed',this._setFixed.bind(this,true)),c('Arbiter').subscribe('Ticker/unfixed',this._setFixed.bind(this,false)),c('Arbiter').subscribe('Ticker/resized',this._checkInfiniteScroll.bind(this)),c('Arbiter').subscribe(c('UFIUIEvents').Comment,this._scrollDialogToBottom.bind(this)),c('Arbiter').subscribe(c('UFIUIEvents').Changed,this._redrawFlyout.bind(this)),c('Arbiter').subscribe('Ticker/chatOpened',this._handleChatOpened.bind(this))];if(!m.pollOnly)this._subscriptions.push(c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('ticker_update'),this._handleTickerPush.bind(this)));if(m.pushChannel&&!m.pollOnly)this.setPushChannel(m.pushChannel);},_handleClick:function l(event){if(!(event.button===1||event.altKey||event.ctrlKey||event.metaKey))event.prevent();var m=event.getTarget(),n=this._getStoryFromNode(m),o=c('Parent').byClass(m,'tickerStoryAllowClick');if(!n||n==this._selectedStory||o)return;if(this._storyIsHidden(n))return;if(n==this._activeStory&&!this._selectedStory)this._selecting=true;if(this._storyCanOpenExternally(n)){var p=n.getAttribute('data-href');if(p&&!m.getAttribute('href')){var q={href:p},r=c('collectDataAttributes')(m,['ft','gt']);c('clickRefAction')('click',q,event,'FORCE',r);}else this._logUserAction(m,'click',event);this._openStoryExternally(n,event);return;}this._logUserAction(m,'flyout',event);this._activateStory(n,'click');this._selectStory(n);},_handleMouseover:function l(event){this._setLocked(true);var m=event.getTarget(),n=this._getOpenableStory(m);if(!n){var o=c('Parent').bySelector(m,"._5wvy");if(o){clearTimeout(parseInt(o.getAttribute('data-timeout-token'),10));var p=c('setTimeout')(function(){k.removeMarkup(o,n);},j);o.setAttribute('data-timeout-token',p);}return;}event.kill();if(this._popupOnHover){if(!(n.id in this._fetchedStories))this._uaCurStoryIDPrefetch=n.id;this._fetchStory(n);}if(this._selectedStory)return;if(this._popupOnHover){this._clearHoverTimeouts();var q=this._storyCanOpenExternally(n)?500:1000,r=this._activeStory?75:q;this._hoverShowTimeout=this._setTimeout(function(){this._activateStory(n,'hover');this._logUserAction(m,'flyout',event);}.bind(this),r);}},_handleMouseout:function l(event){var m=event.getTarget();this._setLocked(false);if(m==this._getStoryFromNode(m)){var n=c('DOM').scry(m.parentNode,'.openToggler');for(var o=0;o<n.length;o++)c('SelectorDeprecated').toggle(n[o]);}this._clearClickedStory();this._scheduleHide();},_handleKeydown:function l(event){this._tickerDeClicker(event);var m=this._activeStory;if(!m)return;var n=c('Event').getKeyCode(event);switch(n){case c('Keys').UP:case c('Keys').DOWN:var o=this._getInsertedStories(),p;if(event.getModifiers().any){p=n===c('Keys').UP?0:o.length-1;}else p=o.indexOf(m)+(n===c('Keys').UP?-1:1);m=o[p];break;case c('Keys').ESC:this._deactivateStory(true);return;default:return;}event.kill();if(!m)return;this._activateStory(m,'keypress');this._selectStory(m);},_fadeTopmostStoryButton:function l(){var m=0,n=15;if(this._storiesWithActions)for(var o in this._storiesWithActions){var p=this._storiesWithActions[o],q=c('DOM').scry(p,'.tickerInlineActionButton')[0],r=c('DOM').scry(q,'.tickerActionIcon')[0],s=c('Vector').getElementPosition(q).y-c('Vector').getElementPosition(this._toggleWrapper).y;if(s<m){c('Style').set(q,'opacity',0);c('Style').set(r,'opacity',0);}else if(s>=m&&s<n){var t=(s-m)/(n-m);c('Style').set(q,'opacity',t);c('Style').set(r,'opacity',t);break;}else{c('Style').set(q,'opacity',1);c('Style').set(r,'opacity',1);}}},_handleScroll:function l(){var m=c('tickerPhoteSnowLiftOpenStatus').checkIsOpen();if(m)this._preventFlyoutDismiss=true;if(!this._preventScrollDismiss&&!m){if(!this._preventFlyoutDismiss){this._deactivateStory(true);}else this._preventFlyoutDismiss=false;}else this._preventScrollDismiss=false;if(!this._handleScrollThrottled)this._handleScrollThrottled=c('throttle')(this._handleScrollInner.bind(this));this._handleScrollThrottled();},_handleScrollInner:function l(){this._fadeTopmostStoryButton();this._checkInfiniteScroll();this._setIsUserScrolling();if(!this._scrollLogged){this._scrollLogged=true;var m=this._stories.childNodes.length,n=this._stories.getAttribute('data-gt'),o={ticker_scroll:1,number_stories:m,source:n};c('clickRefAction')('scroll',null,null,'FORCE',{gt:o});}},_setIsUserScrolling:function l(){clearTimeout(this._userScrollingToken);if(this._isScrolledToTop()){this._userScrolling=false;return;}this._userScrolling=true;this._userScrollingToken=c('setTimeout')(function(){this._userScrolling=false;this._userScrollingToken=null;}.bind(this),this._userScrollGaurdDelay);},_isUserScrolling:function l(){return this._userScrolling;},_handleStoriesInserted:function l(){this._initInfiniteScrollListener();if(this._scrollableArea instanceof c('ScrollableArea'))this._scrollableArea.adjustGripper();},_handleScrollToTopClick:function l(){this._scrollToTop(this._poll.bind(this));},_scheduleScrollToTop:function l(){this._scrollToTopToken&&clearTimeout(this._scrollToTopToken);this._scrollToTopToken=c('setTimeout')(function(){if(this._isLocked()||this._isUserScrolling()){this._scheduleScrollToTop();}else{this._scrollToTopToken=null;this._scrollToTop();}}.bind(this),this._rescheduleScrollToTopDelay);},_scrollToTop:function l(m){new (c('Animation'))(this._container).to('scrollTop',0).ease(c('Animation').ease.end).ondone(m).go();},_clearHoverTimeouts:function l(){clearTimeout(this._hoverShowTimeout);clearTimeout(this._hoverHideTimeout);},_getAllStories:function l(){return c('DOM').scry(this._root,'div.fbFeedTickerStory');},_findStoryById:function l(m){var n=c('DOM').scry(this._root,'.fbFeedTickerStory'),o;for(story in n){o=n[story];if(m==this._getStoryDialogParams(o).token)return o;}return null;},_getInsertedStories:function l(){return this._getAllStories().filter(function(m){return !c('CSS').hasClass(m,'queuedStory');});},_getQueuedStories:function l(){return c('DOM').scry(this._storyQueue,'.fbFeedTickerStory.queuedStory');},_getStoryFromNode:function l(m){return c('Parent').byClass(m,'fbFeedTickerStory');},_getActionButtonFromStory:function l(m){return c('DOM').scry(m,'.tickerInlineActionButton')[0];},_getOpenableStory:function l(m){var n=this._getStoryFromNode(m);return this._storyCanOpenDialog(n)?n:null;},_getStoryDialog:function l(m){return this._fetchedStoriesDialog[m.id]||c('getLegacyContextualDialogInstance')(m);},_getStoryDialogParams:function l(m){var n=m&&m.getAttribute('data-flyoutdata')||null;return n&&JSON.parse(n)||null;},_storyCanOpenDialog:function l(m){return !!this._getStoryDialogParams(m)&&!this._storyIsHidden(m);},_storyCanOpenExternally:function l(m){return !!m.getAttribute('data-href')||!this._storyCanOpenDialog(m);},_storyIsHidden:function l(m){return c('CSS').hasClass(m,'tickerStoryHidden');},hideActiveStory:function l(){this._activeStory&&this.hideStory(this._activeStory);},hideStory:function l(m){this._deactivateStory();if(c('getElementText')(m)==='')c('DOM').remove(m);c('CSS').addClass(m,'tickerStoryHidden');c('CSS').removeClass(m,'tickerStoryClickable');},undoHideStory:function l(m){c('CSS').addClass(m,'tickerStoryClickable');c('CSS').removeClass(m,'tickerStoryHidden');},insertStoriesAtBottom:function l(m){if(!m)return;var n=c('DOM').create('div');n.appendChild(m);var o=c('DOM').scry(n,'.fbFeedTickerStory'),p=c('DOM').find(n,'.tickerMorePager'),q=[];for(var r=0;r<o.length;r++)if(!this.dedupeStory(o[r]))q.push(o[r]);if(q.length){q.push(p);c('DOM').replace(c('DOM').find(this._root,'.tickerMorePager'),q);}c('Arbiter').inform('Ticker/storiesInserted');},_scheduleHide:function l(){if(this._popupOnHover&&!this._selectedStory){this._clearHoverTimeouts();this._hoverHideTimeout=this._setTimeout(this._deactivateStory.bind(this),100);}},_setScrollTopPromptVisible:function l(m){this._scrollTopPromptVisible=m;c('CSS').conditionShow(this._scrollTopPrompt,m);if(m&&!this._listeners.scrollTop){this._listeners.scrollTop=c('Event').listen(this._scrollTopPrompt,{click:this._handleScrollToTopClick.bind(this)});}else if(!m&&this._listeners.scrollTop){this._listeners.scrollTop.click.remove();this._listeners.scrollTop=null;}},_isUserIdle:function l(){return !c('UserActivity').isActive(this._userIdleTimeout);},_schedulePoll:function l(){clearTimeout(this._pollToken);this._pollToken=this._setTimeout(this._poll.bind(this),this._timeout);},_poll:function l(){if(!this._isTickerVisible())return;if(this._storiesToRemove.length>0){if(this._isInsertingStory)return this._schedulePoll();var m=this._storiesToRemove.pop();this.removeStory(m);}var n=!this._isScrolledToTop()&&this._getQueuedStories().length;this._setScrollTopPromptVisible(n);var o=Date.now(),p=o-this._lastInsert;if(p<this._insertTimeout||this._isLocked())return this._schedulePoll();var q=this._getQueuedStories(),r=this._isUserIdle(),s=q.length>0;if(s){var t=q.shift();this.insertStory(t);return this._schedulePoll();}if(r)return c('UserActivity').subscribeOnce(this._poll.bind(this));var u=o-this._lastPull>this._pullTimeout;if(!u)return this._schedulePoll();this.update({pull:true});},_updatePollOnlyHeartbeatTimeout:function l(){if(this._pollOnly&&this._heartbeatTimeout<this._maxHeartbeatTimeout)this._heartbeatTimeout=Math.min(this._heartbeatTimeout+5000,this._maxHeartbeatTimeout);},update:function l(m){this._updatePollOnlyHeartbeatTimeout();if(!this._pollOnly)return this._schedulePoll();var n={newest:m.cache_update?this._newest:this._page_newest,source:this._tickerSource};if(!n.newest||n.newest==='0')throw new Error(c('ex')('Trying to request new ticker stories with an invalid cursor %s, with'+' the settings cache_update %s, value coming from this.%s',typeof n.newest==='string'?'"'+n.newest+'"':n.newest,m.cache_update,m.cache_update?'_newest':'_page_newest'));Object.assign(n,m);new (c('AsyncRequest'))().setURI(this._heartbeatEndpoint).setReadOnly(true).setOption('retries',0).setData(n).setHandler(this._handleResponse.bind(this)).setFinallyHandler(this._poll.bind(this)).setAllowCrossPageTransition(true).send();this._lastUpdate=Date.now();if(n.pull)this._lastPull=this._lastUpdate;},insertStory:function l(m){this._lastInsert=Date.now();window.LiveTimer&&c('LiveTimer').addTimeStamps(m);c('CSS').removeClass(m,'queuedStory');if(this._isUserScrolling()){this._fadeStoryIn(m);}else this._scrollToTop(this._flyStoryIn.bind(this,m));if(this._storiesWithActions&&c('CSS').hasClass(m,'tickerStoryWithButton'))this._storiesWithActions[m.getAttribute('data-story-key')]=m;this._removeOldStories();},_removeOldStories:function l(){var m=this._getInsertedStories();if(m.length<=this._maxStoriesToKeep)return;var n=this._minStoriesToKeep,o=m.slice(n);o.forEach(c('DOM').remove);if(this._storiesWithActions)for(var p=0;p<o.length;p++)delete this._storiesWithActions[o[p].getAttribute('data-story-key')];this._resetMorePager();},_resetMorePager:function l(){var m=this._getInsertedStories();if(!m||!m.length)return;var n=m[m.length-1].getAttribute('data-ticker-timestamp'),o=c('DOM').scry(this._root,'.tickerMorePager a')[0];if(!o||!n)return;var p=new (c('URI'))(o.getAttribute('ajaxify'));p.addQueryData({oldest:n});o.setAttribute('ajaxify',p);},_setLocked:function l(m){this._locked=m;},_isLocked:function l(){return !!(this._locked||this._activeStory);},informAndRemoveStory:function l(m,n,o){var p=this._getStoryFromNode(m),q=p.getAttribute('data-story-key');c('DOM').setContent(p,n);c('CSS').addClass(p,'highlightedStory');this._setTimeout(this.removeStory.bind(this,q),o||6000);},_getStoryByStoryKey:function l(m){var n=this._getAllStories();for(var o=0;o<n.length;o++){var p=n[o];if(p.getAttribute('data-story-key')==m)return p;}return null;},removeStory:function l(m){this._removedStoryIDs[m]=true;var n=this._getStoryByStoryKey(m);if(!n)return;if(this._storiesWithActions)delete this._storiesWithActions[m];if(n==this._activeStory)this._deactivateStory();var o=this._getStoryDialog(n);o&&o.destroy();this._lastKStoriesRemove(n);var p=n.getAttribute("data-dedupe-key");if(p)delete this._dedupeKeys[p];if(c('CSS').hasClass(n,'queuedStory')){c('DOM').remove(n);return;}this._animateStoryOut(n);},_isScrolledToTop:function l(){return this._container.scrollTop<=this._scrollTopThreshold;},_flyStoryIn:function l(m){var n=c('DOM').create('div',{style:{marginTop:'-1000px'}},m);c('Style').set(n,'opacity',0);c('DOM').prependContent(this._stories,n);var o=c('Vector').getElementDimensions(n).y;c('Style').set(n,'marginTop','-'+o+'px');this._isInsertingStory=true;new (c('Animation'))(n).to('marginTop',0).ease(c('Animation').ease.end).checkpoint(.5).to('opacity',1).ondone(function(){c('DOM').replace(n,m);this._afterInsert(m);this._isInsertingStory=false;}.bind(this)).go();},_fadeStoryIn:function l(m){new (c('Animation'))(this._stories).to('opacity',.5).ondone(function(){c('DOM').prependContent(this._stories,m);this._container.scrollTop=this._container.scrollTop+this._stories.firstChild.offsetHeight;this._scheduleScrollToTop();new (c('Animation'))(this._stories).to('opacity',1).ondone(function(){this._afterInsert(m);}.bind(this)).go();}.bind(this)).go();},_animateStoryOut:function l(m){var n=c('DOM').create('div',{style:{overflow:'hidden',position:'relative'}});c('DOM').insertBefore(m,n);c('DOM').appendContent(n,m);new (c('Animation'))(n).to('top',20).to('height',0).to('opacity',0).ease(c('Animation').ease.end).ondone(function(){c('DOM').remove(n);c('Arbiter').inform('Ticker/animateOut');}.bind(this)).go();},_afterInsert:function l(m){c('Arbiter').inform('Ticker/afterInsert');},setPushChannel:function l(m){this._pushSubscription&&this._pushSubscription.unsubscribe();this._pushSubscription=c('Arbiter').subscribe(c('ChannelConstants').getArbiterType(m),this._handleTickerPush.bind(this));e(['ChatConfig','ChannelConnection'],function(n,o){this._channelConnection=o;this._checkChannelConnection();this._channelConnectionSubscription=this._channelConnection.subscribe([this._channelConnection.CONNECTED,this._channelConnection.RECONNECTING,this._channelConnection.SHUTDOWN,this._channelConnection.MUTE_WARNING,this._channelConnection.UNMUTE_WARNING],this._handleChannelConnection.bind(this));}.bind(this));},_checkChannelConnection:function l(){c('CSS').conditionClass(this._root,'disconnected',this._channelConnection.disconnected());},_handleTickerPush:function l(m,n){var o=n.obj;if(o.delete_id){this._storiesToRemove.push(o.delete_id);return;}var p=o.story_xhp;if(!p)return;var q=c('HTML')(p).getRootNode();if(!o.story_time||o.story_time==='0')throw new Error(c('ex')('An invalid story time was pushed: %s, for ticker story: %s',typeof o.story_time==='string'?'"'+o.story_time+'"':o.story_time,q.getAttribute('data-flyoutdata')));this._newest=o.story_time;this.queueStory(q,o.flyout_js_cmds);this._newestStory={actorID:o.actor,storyKey:q.getAttribute('data-story-key')};},_handleComposerPublish:function l(m,n){n.tickerMarkup&&this.insertStory(n.tickerMarkup);},_logRender:function l(){if(this._loggedRender)return;var m=this._tickerInSidebarMode;if(m||c('Parent').byClass(this._content,'home_right_column')){new (c('AsyncSignal'))('/ajax/log_ticker_render.php',{sidebar_mode:m}).send();this._loggedRender=true;}},_isTickerVisible:function l(){var m=c('TickerController').getActiveInstance()==this;m&&this._logRender();return m;},_handleResponse:function l(m){var n=m.getPayload();if(n.newest)this._newest=this._page_newest=n.newest;if(n.content)if(n.content instanceof Array){for(var o=0;o<n.content.length;o++)this.queueStoryMarkup(n.content[o]);}else this.queueStoryMarkup(n.content);},queueStoryMarkup:function l(m){var n=c('HTML')(m).getRootNode();this.queueStory(n);},dedupeStory:function l(m){var n=m.getAttribute('data-story-key'),o=n&&(!!this._objectIDs[n]||!!this._removedStoryIDs[n]);o=o||!!this._lastKStories.actors[m.getAttribute('data-actor')]||!!this._lastKStories.apps[m.getAttribute('data-app')];var p=m.getAttribute('data-dedupe-key');o=o||p&&this._dedupeKeys[p];if(m.getAttribute('data-force-push'))o=false;n&&(this._objectIDs[n]=true);return o;},queueStory:function l(m,n){if(this.dedupeStory(m))return;this._lastKStoriesInsert(m);var o=m.getAttribute("data-dedupe-key");if(o)this._dedupeKeys[o]=true;c('CSS').addClass(m,'queuedStory');c('DOM').appendContent(this._storyQueue,m);var p=n&&n.length;if(p)n.forEach(function(r){new Function(r).apply();});m.setAttribute('id',m.id+'_'+this._root.id);var q=this._getQueuedStories();q.slice(0,-this._maxQueueLength).forEach(c('DOM').remove);if(p)this._fetchedStories[m.id]=true;},_cleanup:function l(){c('TickerController').clearRHCplaceholder();if(!c('Parent').byClass(this._content,'hasRightCol'))return;this._objectIDs=[];this._subscriptions.forEach(c('Arbiter').unsubscribe);this._channelConnectionSubscription&&this._channelConnection.unsubscribe(this._channelConnectionSubscription);this._pushSubscription&&this._pushSubscription.unsubscribe();for(var m in this._listeners)this._listeners[m]&&this._listeners[m].remove();clearTimeout(this._pollToken);this._pollToken=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();c('Arbiter').inform('Ticker/cleanup');},_onNavHandler:function l(m,n){var o=n.params.key;if(o!='lf'&&o!='h')this._cleanup();},registerStoryDialog:function l(m,n){if(this._uaCurStoryIDFetch==m.id)this._uaCurStoryIDFetch=null;if(this._uaCurStoryIDPrefetch==m.id)this._uaCurStoryIDPrefetch=null;this._fetchedStories[m.id]=true;this._fetchedStoriesDialog[m.id]=n;n.setContext(m);n.subscribe('hide',this._deactivateStory.bind(this,true));n.subscribe('success',this._focusStory.bind(this,m));n.subscribe('beforehide',function(){if(this._selecting){this._selecting=false;return false;}}.bind(this));if(this._popupOnHover){n.subscribe('mouseenter',this._clearHoverTimeouts.bind(this));n.subscribe('mouseleave',this._scheduleHide.bind(this));n.subscribe('show',function(){c('setTimeout')(this._highlightDialogScrollbar.bind(this,n),0);var o=c('Event').listen(n.getContent(),'mousedown',function(){this._selectStory(m);o.remove();}.bind(this));}.bind(this));}if(m==this._activeStory)this._openDialog(n);},_highlightDialogScrollbar:function l(m){var n=c('DOM').scry(m.getContent(),'.uiScrollableArea')[0];n&&c('ScrollableArea').poke(n);},_openStoryExternally:function l(m,event){var n=m.getAttribute('data-href');if(!n||n=='#')return;var o=m.getAttribute('data-story-rel');switch(o){case 'theater':this._deactivateAndClearStory();c('Bootloader').loadModules(["PhotoViewer"],function(r){r.bootstrap(n,m);},'TickerStoryList');return;case 'async':this._deactivateAndClearStory();c('AsyncRequest').bootstrap(n,m);return;}var p=m.getAttribute('data-target'),q=event.which!=1||event.getModifiers().any||p=='_blank';q?window.open(n,'_blank'):c('goURI')(n);},_deactivateAndClearStory:function l(){this._clearHoverTimeouts();this._deactivateStory();},_focusStoryWillTriggerScroll:function l(m){var n=this._container,o=n.clientHeight,p=m.offsetHeight,q=n.scrollTop,r=q+o,s=m.offsetTop,t=s+p;return s<q||t>r;},_focusStory:function l(m){if(this._focusStoryWillTriggerScroll(m))this._preventScrollDismiss=true;var n=new (c('Rect'))(m),o=c('Parent').byClass(m,'scrollable'),p=n.boundWithin(new (c('Rect'))(o)).getPositionVector(),q=n.getPositionVector().sub(p);if(q.y!==0)q.scrollElementBy(o);m.focus();},_selectStory:function l(m){this._selectedStory=m;c('CSS').addClass(m,'tickerStorySelected');c('CSS').addClass(this._root,'tickerChildSelected');},_activateStory:function l(m,n){this._clearHoverTimeouts();if(m==this._activeStory||!this._storyCanOpenDialog(m))return;this._deactivateStory();this._focusStory(m);this._activeStory=m;c('CSS').addClass(m,'tickerStoryActive');window.Toggler&&c('Toggler').hide();if(this._logFlyouts){n=n||'unknown';new (c('AsyncSignal'))('/ajax/feed/ticker/flyout.php',{src:n}).send();}c('TickerReadStateTracking').log(m);var o=this._getStoryDialog(m);if(o){if(this._storyDialogResources[m.id])c('Bootloader').loadResources(this._storyDialogResources[m.id]);this._openDialog(o);c('BanzaiODS').bumpEntityKey('ticker_stories','flyouts.open');return;}if(!(m.id in this._fetchedStories))this._uaCurStoryIDFetch=m.id;this._fetchStory(m);},handleRemoveStory:function l(){this._deactivateStory(true);},_deactivateStory:function l(m){if(this._activeStory===this._deactivatingStory)return;this._deactivatingStory=this._activeStory;if(this._dialog){if(m){this._dialog.enableBehavior(c('LayerFadeOnHide'));}else this._dialog.disableBehavior(c('LayerFadeOnHide'));this._dialog.hide();}if(this._activeStory){c('CSS').removeClass(this._activeStory,'tickerStoryActive');c('CSS').removeClass(this._activeStory,'tickerStorySelected');c('CSS').removeClass(this._root,'tickerChildSelected');}this._dialog=this._selectedStory=this._activeStory=null;this._cleanupInputFocusListener();this._cleanupContentResizeListener();this._deactivatingStory=null;},_logUserAction:function l(m,n,event){c('clickRefAction')(n,m,event,'FORCE');},_fetchStory:function l(m){clearTimeout(this._fetchToken);var n=[],o=this._getInsertedStories(),p=o.indexOf(m);[-1,0,1].forEach(function(q){var r=o[p+q];r&&n.push(r);},this);this._fetchToken=c('setTimeout')(this._fetchStories.bind(this,n),100);},_fetchStories:function l(m){var n=[],o,p=function q(r){clearTimeout(o);m.forEach(function(s){c('CSS').conditionClass(s,'tickerStoryFetching',r);});};m=m.filter(function(q){if(q.id in this._fetchedStories)return false;this._fetchedStories[q.id]=true;var r=this._getStoryDialogParams(q);if(!r)return false;r.uniq_id=q.getAttribute('id');r.referrer=this._tickerSource;n.push(r);return true;},this);if(!n.length)return;o=this._setTimeout(p.bind(null,true),500);new (c('AsyncRequest'))('/ajax/feed/ticker/multi_story').setInitialHandler(this._handleDialogResponse.bind(this,n)).setFinallyHandler(p.bind(null,false)).setErrorHandler(c('emptyFunction')).setData({stories:n}).setAllowCrossPageTransition(this._tickerInSidebarMode).send();},_handleDialogResponse:function l(m,n){if(n&&n.resource_map){var o=[];for(var p in n.resource_map){var q=n.resource_map[p];if(q.type==='css'&&!q.permanent)o.push(p);}if(o.length>0)for(var r=0;r<m.length;r++)this._storyDialogResources[m[r].uniq_id]=o;}},_tickerDeClicker:function l(event){var m=event.getTarget(),n=c('Parent').byTag(m,'a'),o=this._getStoryFromNode(m);if(o&&n&&c('CSS').hasClass(o,'tickerStoryClickable')&&!c('CSS').hasClass(n,'tickerStoryAllowClick')&&!this._storyIsHidden(o))n.setAttribute('rel','ignore');var p=event.button==2,q=event.type==='keydown',r=o&&this._getActionButtonFromStory(o);if(!p&&r&&!q)this._setClickedStory(o);},_handleMouseup:function l(event){this._clearClickedStory();},_setClickedStory:function l(m){this._clearClickedStory();c('CSS').addClass(m,'tickerStoryClicked');this._clickedStory=m;},_clearClickedStory:function l(){if(this._clickedStory){c('CSS').removeClass(this._clickedStory,'tickerStoryClicked');this._clickedStory=null;}},_initInfiniteScrollListener:function l(){var m=this._getInsertedStories();if(this._storiesWithActions)for(var n=0;n<m.length;n++){var o=m[n];if(c('CSS').hasClass(o,'tickerStoryWithButton'))this._storiesWithActions[o.getAttribute('data-story-key')]=o;}var p=Math.max(0,m.length-this._autoloadStoryIndex);this._infiniteScrollStory=m[p];this._checkInfiniteScroll();},_checkInfiniteScroll:function l(){if(this._infiniteScrollStory){var m=c('Vector').getElementPosition(this._infiniteScrollStory).y,n=c('Vector').getElementPosition(this._container).y+c('Vector').getElementDimensions(this._container).y;if(m<n){var o=c('DOM').scry(this._root,'.tickerMorePager a')[0];if(o){var p=c('Parent').byClass(o,'stat_elem')||o;new (c('AsyncRequest'))(o.getAttribute('ajaxify')).setReadOnly(true).setRelativeTo(o).setStatusElement(p).setAllowCrossPageTransition(true).send();}this._infiniteScrollStory=null;this._autoloadStoryIndex=5;}}},_setFixed:function l(m){if(!this._selectedStory)return;var n=this._getStoryDialog(this._selectedStory);if(n){n.setFixed&&n.setFixed(m);n.updatePosition();}},_setTimeout:function l(m,n){return c('setTimeout')(m,n,!this._tickerInSidebarMode);},_scrollDialogToBottom:function l(){var m=this._dialog&&this._dialog.getContent(),n=m&&c('DOM').scry(m,'.uiScrollableAreaWrap')[0],o=n&&c('ScrollableArea').getInstance(n);o&&o.scrollToBottom();},_redrawFlyout:function l(m,n){if(this._hasUFIUpdated)return;var o=this._dialog;if(o&&o.isShown()&&c('containsNode')(o.getContent(),n.form)){this._hasUFIUpdated=true;this._updateDialogPosition();}},_openDialog:function l(m){if(!this._tickerInSidebarMode)c('CSS').addClass(m.getRoot(),'tickerStoryOverlayOnTop');this._hasUFIUpdated=false;var n=c('DOMVector').getScrollPosition();this._dialog=m.show();window.scrollTo(n.x,n.y);this._updateDialogPosition();this._writeSwfFrame(m);c('setTimeout')(this._initCommentFocusListener.bind(this),0);c('setTimeout')(this._initContentResizeListener.bind(this),0);this._stupidIE7VideoResizeHack(m);},_stupidIE7VideoResizeHack:function l(m){if(c('UserAgent_DEPRECATED').ie()===7){var n=c('DOM').scry(m.getContent(),'.uiVideoThumb .img');n.forEach(function(o){c('Style').set(o,'width','');});}},_updateDialogPosition:function l(){var m=this._tickerInSidebarMode||!!c('Parent').byClass(this._root,'fixed_elem');this._dialog.setFixed&&this._dialog.setFixed(m);this._adjustFlyoutContentHeight();this._dialog.updatePosition();},_writeSwfFrame:function l(m){var n=this._dialog&&this._dialog.getContent(),o=c('DOM').scry(n,'.swfObject')[0];if(!o)return;var p=o.getAttribute('data-swfid');if(p&&window[p]){var q=window[p];q.write(o);}},_initCommentFocusListener:function l(){var m=this._dialog&&this._dialog.getContent(),n=m&&c('DOM').scry(m,'.tickerDialogFooter textarea')[0];if(!n)return;this._listeners.inputFocus=c('Event').listen(n,'focus',this._scrollDialogToBottom.bind(this));},_cleanupInputFocusListener:function l(){if(this._listeners.inputFocus){this._listeners.inputFocus.remove();this._listeners.inputFocus=null;}},_initContentResizeListener:function l(){var m=this._dialog&&this._dialog.getContent();if(!m)return;this._listeners.contentResize=c('Event').listen(m,'click',function(){c('setTimeout')(this._dialog.updatePosition.bind(this._dialog),0);}.bind(this));},_cleanupContentResizeListener:function l(){if(this._listeners.contentResize){this._listeners.contentResize.remove();this._listeners.contentResize=null;}},_adjustFlyoutContentHeight:function l(){var m=this._dialog&&this._dialog.getContent(),n=m&&c('DOM').scry(m,'.uiScrollableAreaWrap')[0];if(!n)return;var o=c('Vector').getElementDimensions(n),p=c('Vector').getElementPosition(n),q=c('DOM').scry(n,'.uiUfi .uiUfiComment'),r=c('DOM').scry(n,".UFILikeSentence")[0],s=this.FLYOUT_MAX_HEIGHT;if(r){var t=c('Vector').getElementPosition(r).y||0;s=Math.max(s,this.FLYOUT_TARGET_HEIGHT_OFFSET+n.scrollTop+t+r.offsetHeight-p.y);}var u=c('Vector').getViewportDimensions().y-this.FLYOUT_VIEWPORT_PADDING;s=Math.min(s,u);var v=s-this.FLYOUT_TARGET_HEIGHT_OFFSET;for(var w=0;w<q.length;w++){var x=q[w],y=c('Vector').getElementPosition(x),z=y.y-p.y;if(Math.abs(z-v)<=this.FLYOUT_OFFSET_THRESHOLD){v=z+this.FLYOUT_COMMENT_OFFSET;break;}}if(o.y>=v){c('Style').set(n,'height',v+'px');c('Style').set(n,'max-height',null);}else{c('Style').set(n,'max-height',s+'px');c('Style').set(n,'height',null);}},_initObjectIDs:function l(){var m=this._getAllStories();for(var n=m.length-1;n>=0;n--){var o=m[n].getAttribute('data-story-key');if(o){this._objectIDs[o]=true;this._lastKStoriesInsert(m[n]);var p=m[n].getAttribute("data-dedupe-key");if(p)this._dedupeKeys[p]=true;}}},_handleChatOpened:function l(){this._deactivateStory();},_handleChannelConnection:function l(){this._checkChannelConnection();},getNewest:function l(){return this._newest;}});f.exports=k;}),null);